<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='基础知识'><title>Mysql</title>

<link rel='canonical' href='https://gao377020481.github.io/p/mysql/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Mysql'>
<meta property='og:description' content='基础知识'>
<meta property='og:url' content='https://gao377020481.github.io/p/mysql/'>
<meta property='og:site_name' content='Gao&#39;s Happy Day'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='数据库' /><meta property='article:published_time' content='2020-06-06T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2020-06-06T00:00:00&#43;00:00'/><meta property='og:image' content='https://gao377020481.github.io/p/mysql/537.jpg' />
<meta name="twitter:title" content="Mysql">
<meta name="twitter:description" content="基础知识"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://gao377020481.github.io/p/mysql/537.jpg' />
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://gao377020481.github.io" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/mysql/">
                <img src="/p/mysql/537_huc4722358eae36c77295feb62b7419b0c_34031398_800x0_resize_q75_box.jpg"
                        srcset="/p/mysql/537_huc4722358eae36c77295feb62b7419b0c_34031398_800x0_resize_q75_box.jpg 800w, /p/mysql/537_huc4722358eae36c77295feb62b7419b0c_34031398_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="1200" 
                        loading="lazy"
                        alt="Featured image of post Mysql" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="background-color: #2a9d8f; color: #fff;">
                数据库
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/mysql/">Mysql</a>
    </h2>

    
    <h3 class="article-subtitle">
        基础知识
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 06, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    3 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="视图">视图</h2>
<p>视图（view）是一种虚拟存在的表，是一个逻辑表，本身并不包含数据。其内容由查询定义。
基表：用来创建视图的表叫做基表。
通过视图，可以展现基表的部分数据。
视图数据来自定义视图的查询中使用的表，使用视图动态生成。</p>
<h3 id="优点">优点</h3>
<ol>
<li>简单：使用视图的用户完全不需要关心后面对应的表的结构、关联条件和筛选条件，对用户来说已经是过滤好的复合条件的结果集。</li>
<li>安全：使用视图的用户只能访问他们被允许查询的结果集，对表的权限管理并不能限制到某个行某个列，但是通过视图就可以简单的实现。</li>
<li>数据独立：一旦视图的结构确定了，可以屏蔽表结构变化对用户的影响，源表增加列对视图没有影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">&lt;</span><span class="err">视图名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">&lt;</span><span class="n">SELECT语句</span><span class="o">&gt;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h2 id="触发器">触发器</h2>
<p>触发器（trigger）是MySQL提供给程序员和数据分析员来保证数据完整性的一种方法，它是与表事件相关的特殊的存储过程，它的执行不是由程序调用，也不是手工启动，而是由事件来触发，比如当对一个表进行DML操作（ insert ， delete ， update ）时就会激活它执行。</p>
<p>监视对象： table</p>
<p>监视事件： insert 、 update 、 delete</p>
<p>触发时间： before ， after</p>
<p>触发事件： insert 、 update 、 delete</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="k">work</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">auto_increment</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="o">`</span><span class="n">address</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INNODB</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">auto_increment</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="w"> </span><span class="n">DATETIME</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INNODB</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">trig_test1</span><span class="w"> </span><span class="k">AFTER</span><span class="w"> </span><span class="k">INSERT</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="k">work</span><span class="o">`</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">time</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span><span class="w">
</span><span class="w">
</span></code></pre></div><h2 id="存储过程">存储过程</h2>
<p>SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。</p>
<p>存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。</p>
<h3 id="优点-1"><strong>优点</strong></h3>
<ol>
<li>能完成较复杂的判断和运算 有限的编程</li>
<li>可编程行强，灵活</li>
<li>SQL编程的代码可重复使用</li>
<li>执行的速度相对快一些</li>
<li>减少网络之间的数据传输，节省开销</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="err">过程名</span><span class="p">([[</span><span class="k">IN</span><span class="o">|</span><span class="k">OUT</span><span class="o">|</span><span class="k">INOUT</span><span class="p">]</span><span class="w"> </span><span class="err">参数名</span><span class="w"> </span><span class="err">数据类型</span><span class="p">[,[</span><span class="k">IN</span><span class="o">|</span><span class="k">OUT</span><span class="o">|</span><span class="k">INOUT</span><span class="p">]</span><span class="w"> </span><span class="err">参数名</span><span class="w"> </span><span class="err">数</span><span class="w">
</span><span class="w"></span><span class="err">据类型…</span><span class="p">]])</span><span class="w"> </span><span class="p">[</span><span class="err">特性</span><span class="w"> </span><span class="p">...]</span><span class="w"> </span><span class="err">过程体</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用&quot;,&ldquo;分割开。</p>
<p>MySQL 存储过程的参数用在存储过程的定义，共有三种参数类型 IN , OUT , INOUT 。</p>
<p>IN ：参数的值必须在调用存储过程时指定，0在存储过程中修改该参数的值不能被返回，可以设置默认值</p>
<p>OUT ：该值可在存储过程内部被改变，并可返回</p>
<p>INOUT ：调用时指定，并且可被改变和返回</p>
<p>过程体的开始与结束使用 BEGIN 与 END 进行标识。</p>
<h2 id="游标">游标</h2>
<p>游标是针对行操作的，对从数据库中 select 查询得到的结果集的每一行可以进行分开的独立的相同或者不相同的操作。</p>
<p>对于取出多行数据集，需要针对每行操作；可以使用游标；游标常用于存储过程、函数、触发器、事件。</p>
<p>游标相当于迭代器</p>
<p>直接来个例子就知道：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">proc_while</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="k">IN</span><span class="w"> </span><span class="n">age_in</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="k">OUT</span><span class="w"> </span><span class="n">total_out</span><span class="w"> </span><span class="nb">INT</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span><span class="w"></span><span class="c1">-- 创建 用于接收游标值的变量
</span><span class="c1"></span><span class="k">DECLARE</span><span class="w"> </span><span class="n">p_id</span><span class="p">,</span><span class="n">p_age</span><span class="p">,</span><span class="n">p_total</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">DECLARE</span><span class="w"> </span><span class="n">p_sex</span><span class="w"> </span><span class="n">TINYINT</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 注意:接收游标值为中文时,需要给变量 指定字符集utf8
</span><span class="c1"></span><span class="k">DECLARE</span><span class="w"> </span><span class="n">p_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 游标结束的标志
</span><span class="c1"></span><span class="k">DECLARE</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 声明游标
</span><span class="c1"></span><span class="k">DECLARE</span><span class="w"> </span><span class="n">cur_teacher</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">SELECT</span><span class="w">
</span><span class="w"></span><span class="n">teacher_id</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">teacher_name</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">teacher_sex</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">teacher_age</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w">
</span><span class="w"></span><span class="n">teacher</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w">
</span><span class="w"></span><span class="n">teacher_age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">age_in</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 指定游标循环结束时的返回值
</span><span class="c1"></span><span class="k">DECLARE</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w"> </span><span class="k">HANDLER</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">found</span><span class="w">
</span><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 打开游标
</span><span class="c1"></span><span class="k">OPEN</span><span class="w"> </span><span class="n">cur_teacher</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 初始化 变量
</span><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="n">p_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- while 循环
</span><span class="c1"></span><span class="n">WHILE</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DO</span><span class="w">
</span><span class="w"></span><span class="k">FETCH</span><span class="w"> </span><span class="n">cur_teacher</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">p_id</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">p_name</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">p_sex</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">p_age</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">p_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">END</span><span class="w">
</span><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">END</span><span class="w">
</span><span class="w"></span><span class="n">WHILE</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 关闭游标
</span><span class="c1"></span><span class="k">CLOSE</span><span class="w"> </span><span class="n">cur_teacher</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">-- 将累计的结果复制给输出参数
</span><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="n">total_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_total</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">END</span><span class="o">//</span><span class="w">
</span><span class="w"></span><span class="k">delimiter</span><span class="w"> </span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 调用
</span><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="n">p_age</span><span class="w"> </span><span class="o">=</span><span class="mi">20</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">CALL</span><span class="w"> </span><span class="n">proc_while</span><span class="p">(</span><span class="o">@</span><span class="n">p_age</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">total</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">total</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">
</span></code></pre></div><h2 id="索引">索引</h2>
<p>分类：主键索引、唯一索引、普通索引、组合索引、以及全文索引；</p>
<h3 id="主键索引">主键索引</h3>
<p>非空唯一索引，一个表只有一个主键索引；在 innodb 中，主键索引的B+树包含表数据信息。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="k">key</span><span class="p">)</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="唯一索引">唯一索引</h3>
<p>不可以出现相同的值，可以有NULL值。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">UNIQUE</span><span class="p">(</span><span class="k">key</span><span class="p">)</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="普通索引">普通索引</h3>
<p>允许出现相同的索引内容。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">INDEX</span><span class="p">(</span><span class="k">key</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="c1">-- OR
</span><span class="c1"></span><span class="k">KEY</span><span class="p">(</span><span class="k">key</span><span class="p">[,...])</span><span class="w">
</span></code></pre></div><h3 id="组合索引">组合索引</h3>
<p>对表上的多个列进行索引。 符合<strong>最左匹配原则</strong>：从左到右依次匹配，遇到 &gt; &lt; between like 就停止匹配；</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span><span class="n">key2</span><span class="p">[,...]);</span><span class="w">
</span><span class="w"></span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span><span class="n">key2</span><span class="p">[,...]);</span><span class="w">
</span><span class="w"></span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span><span class="n">key2</span><span class="p">[,...]);</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="全文索引">全文索引</h3>
<p>将存储在数据库当中的整本书和整篇文章中的任意内容信息查找出来的技术；关键词 FULLTEXT;
在短字符串中用 LIKE % ；在全文索引中用 match 和 against。</p>
<h3 id="主键选择规则">主键选择规则</h3>
<p>innodb 中表是索引组织表，每张表有且仅有一个主键。</p>
<ol>
<li>如果显示设置 PRIMARY KEY ，则该设置的key为该表的主键。</li>
<li>如果没有显示设置，则从非空唯一索引中选择。
<ol>
<li>只有一个非空唯一索引，则选择该索引为主键。</li>
<li>有多个非空唯一索引，则选择声明的第一个为主键。</li>
</ol>
</li>
<li>没有非空唯一索引，则自动生成一个 6 字节的 _rowid 作为主键。</li>
</ol>
<h3 id="索引实现">索引实现</h3>
<h4 id="索引存储"><strong>索引存储</strong></h4>
<p>innodb由段、区、页组成；段分为数据段、索引段、回滚段等。区大小为 1 MB（一个区由64个连续页构成）。页的默认值为16k。页为逻辑页，磁盘物理页大小一般为 4K 或者 8K。为了保证区中的页的连续，存储引擎一般一次从磁盘中申请 4~5 个区。</p>
<h4 id="聚集索引与辅助索引"><strong>聚集索引与辅助索引</strong></h4>
<p>聚集索引就是以主键为key构造B+树</p>
<p>辅助索引就是以辅助索引为key构造B+树，value为对应的主键</p>
<h4 id="页和b树"><strong>页和B+树</strong></h4>
<p>B+树单个节点是页，页中由id再向下分裂指向多个页。</p>
<p>我们知道主键索引的id就是B+树节点的key，为了范围查询我们不使用hashmap，那为什么不用B树呢？</p>
<p>这是因为B树在叶子节点上保存数据，执行范围查询时，可能需要反复载入不连续的页，cache和内存的利用率都不是很高。而B+树直接进入叶子节点，然后范围查询只需要根据叶子节点之间的指针载入连续的页就行，这种确定的内存访问优化空间更大，效率更高。</p>
<h3 id="索引失效">索引失效</h3>
<ol>
<li>select &hellip; where A and B 若 A 和 B 中有一个不包含索引，则索引失效。</li>
<li>索引字段参与运算，则索引失效；例如： from_unixtime(idx) = &lsquo;2021-04-30&rsquo;。</li>
<li>索引字段发生隐式转换，则索引失效；例如： &lsquo;1&rsquo; 隐式转换为 1 。</li>
<li>LIKE 模糊查询，通配符 % 开头，则索引失效；例如： select * from user where name like &lsquo;%ark&rsquo;。</li>
<li>在索引字段上使用 NOT &lt;&gt; != 索引失效；如果判断 id &lt;&gt; 0 则修改为 idx &gt; 0 or idx &lt; 0 。</li>
<li>组合索引中，没使用第一列索引，索引失效。</li>
</ol>
<h3 id="索引原则">索引原则</h3>
<ol>
<li>查询频次较⾼且数据量⼤的表建⽴索引；索引选择使⽤频次较⾼，过滤效果好的列或者组合。</li>
<li>使⽤短索引；节点包含的信息多，较少磁盘io操作。</li>
<li>对于很长的动态字符串，考虑使用前缀索引。</li>
<li>对于组合索引，考虑最左侧匹配原则和覆盖索引。</li>
<li>尽量选择区分度⾼的列作为索引；该列的值相同的越少越好。</li>
<li>尽量扩展索引，在现有索引的基础上，添加复合索引。</li>
<li>不要 select * ； 尽量只列出需要的列字段。</li>
<li>索引列，列尽量设置为非空。</li>
</ol>
<h3 id="约束">约束</h3>
<p>为了实现数据的完整性，对于innodb，提供了以下几种约束，primary key，unique key，foreign key， default, not null。</p>
<h4 id="外键约束"><strong>外键约束</strong></h4>
<p>外键用来关联两个表，来保证参照完整性；MyISAM存储引擎本身并不支持外键，只起到注释作用。而innodb完整支持外键。</p>
<h4 id="约束于索引的区别"><strong>约束于索引的区别</strong></h4>
<p>创建主键索引或者唯一索引的时候同时创建了相应的约束；但是约束是<strong>逻辑上的概念</strong>；索引是一个<strong>数据结构</strong>既包含逻辑的概念也包含物理的存储方式；</p>
<h2 id="事务">事务</h2>
<p>事务将数据库从一种一致性状态转换为另一种一致性状态。</p>
<p>在数据库提交事务时，可以确保要么所有修改都已经保存，要么所有修改都不保存。</p>
<p>事务是访问并更新数据库各种数据项的一个程序执行单元。</p>
<p>在 MySQL innodb 下，每一条语句都是事务。可以通过 set autocommit = 0， 设置当前会话手动提交。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="c1">-- 显示开启事务
</span><span class="c1"></span><span class="k">START</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">BEGIN</span><span class="w">
</span><span class="w"></span><span class="c1">-- 提交事务，并使得已对数据库做的所有修改持久化
</span><span class="c1"></span><span class="k">COMMIT</span><span class="w">
</span><span class="w"></span><span class="c1">-- 回滚事务，结束用户的事务，并撤销正在进行的所有未提交的修改
</span><span class="c1"></span><span class="k">ROLLBACK</span><span class="w">
</span><span class="w"></span><span class="c1">-- 创建一个保存点，一个事务可以有多个保存点
</span><span class="c1"></span><span class="n">SAVEPOINT</span><span class="w"> </span><span class="n">identifier</span><span class="w">
</span><span class="w"></span><span class="c1">-- 删除一个保存点
</span><span class="c1"></span><span class="n">RELEASE</span><span class="w"> </span><span class="n">SAVEPOINT</span><span class="w"> </span><span class="n">identifier</span><span class="w">
</span><span class="w"></span><span class="c1">-- 事务回滚到保存点
</span><span class="c1"></span><span class="k">ROLLBACK</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="n">SAVEPOINT</span><span class="p">]</span><span class="w"> </span><span class="n">identifier</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="acid特性">ACID特性</h3>
<h4 id="原子性a"><strong>原子性（A）</strong></h4>
<p>事务操作要么都做（提交），要么都不做（回滚）。事务是访问并更新数据库各种数据项的一个程序执行单元，是不可分割的工作单位。通过undolog来实现回滚操作。undolog记录的是事务每步具体操作，当回滚时，回放事务具体操作的逆运算。</p>
<h4 id="隔离性i"><strong>隔离性（I）</strong></h4>
<p>事务的隔离性要求每个读写事务的对象对其他事务的操作对象能相互分离，也就是事务提交前对其他事务都不可见。通过 MVCC 和 锁来实现。MVCC 时多版本并发控制，主要解决一致性非锁定读，通过记录和获取行版本，而不是使用锁来限制读操作，从而实现高效并发读性能。锁用来处理并发 DML 操作。数据库中提供粒度锁的策略，针对表（聚集索引B+树）、页（聚集索引B+树叶子节点）、行（叶子节点当中某一段记录行）三种粒度加锁。</p>
<h4 id="持久性d"><strong>持久性（D）</strong></h4>
<p>事务提交后，事务DML操作将会持久化（写入redolog磁盘文件 哪一个页 页偏移值 具体数据）。即使发生宕机等故障，数据库也能将数据恢复。redolog记录的是物理日志。</p>
<h4 id="一致性c"><strong>一致性（C）</strong></h4>
<p>一致性指事务将数据库从一种一致性状态转变为下一种一致性的状态，在事务执行前后，数据库完整性约束没有被破坏。例如：一个表的姓名是唯一键，如果一个事务对姓名进行修改，但是在事务提交或事务回滚后，表中的姓名变得不唯一了，这样就破坏了一致性。一致性由原子性、隔离性以及持久性共同来维护的。</p>
<h3 id="事务并发异常">事务并发异常</h3>
<h4 id="脏读"><strong>脏读</strong></h4>
<p>事务（A）可以读到另外一个事务（B）中未提交的数据，也就是事务A读到脏数据。在读写分离的场景下，可以将slave节点设置为 READ UNCOMMITTED。此时脏读不影响，在slave上查询并不需要特别精准的返回值。</p>
<h4 id="不可重复读"><strong>不可重复读</strong></h4>
<p>事务（A) 可以读到另外一个事务（B）中提交的数据。通常发生在一个事务中两次读到的数据是不一样的情况。不可重复读在隔离级别 READ COMMITTED 存在。一般而言，不可重复读的问题是可以接受的，因为读到已经提交的数据，一般不会带来很大的问题，所以很多厂商（如Oracle、SQL Server）默认隔离级别就是READ COMMITTED。</p>
<h4 id="幻读"><strong>幻读</strong></h4>
<p>事务中一次读操作不能支撑接下来的业务逻辑。通常发生在一个事务中一次读判断接下来写操作失败的情况。例如：以name为唯一键的表，一个事务中查询 select * from t where name =&lsquo;mark&rsquo;。不存在，接下来 insert into t(name) values (&lsquo;mark&rsquo;)。 出现错误，此时另外一个事务也执行了 insert 操作。幻读在隔离级别 REPEATABLE READ 及以下存在。但是可以在REPEATABLE READ 级别下通过读加锁（使用next-key locking）解决。</p>
<h3 id="隔离级别">隔离级别</h3>
<p>ISO和ANIS SQL标准制定了四种事务隔离级别的标准，各数据库厂商在正确性和性能之间做了妥协，并没有严格遵循这些标准。MySQL innodb默认支持的隔离级别是 REPEATABLE READ。</p>
<h4 id="read-uncommitted"><strong>READ UNCOMMITTED</strong></h4>
<p>读未提交：该级别下读不加锁，写加排他锁，写锁在事务提交或回滚后释放锁。</p>
<h4 id="read-committed"><strong>READ COMMITTED</strong></h4>
<p>读已提交：从该级别后支持 MVCC (多版本并发控制)，也就是提供一致性非锁定读。此时读取操作读取历史快照数据。该隔离级别下选择读取快照中历史版本的最新数据，所以读取的是已提交的数据。</p>
<h4 id="repeatable-read"><strong>REPEATABLE READ</strong></h4>
<p>可重复读：该级别下也支持 MVCC，此时读取操作读取事务开始时的版本数据。</p>
<h4 id="serializable"><strong>SERIALIZABLE</strong></h4>
<p>可串行化：该级别下给读加了共享锁。所以事务都是串行化的执行，此时隔离级别最严苛。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="c1">-- 设置隔离级别
</span><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="p">[</span><span class="k">GLOBAL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">SESSION</span><span class="p">]</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="k">ISOLATION</span><span class="w"> </span><span class="k">LEVEL</span><span class="w"> </span><span class="k">REPEATABLE</span><span class="w"> </span><span class="k">READ</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 或者采用下面的方式设置隔离级别
</span><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="o">@@</span><span class="n">tx_isolation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;REPEATABLE READ&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">tx_isolation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;REPEATABLE READ&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 查看全局隔离级别
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">tx_isolation</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 查看当前会话隔离级别
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@@</span><span class="k">session</span><span class="p">.</span><span class="n">tx_isolation</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@@</span><span class="n">tx_isolation</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 手动给读加 S 锁
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">LOCK</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SHARE</span><span class="w"> </span><span class="k">MODE</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 手动给读加 X 锁
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">UPDATE</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">-- 查看当前锁信息
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_locks</span><span class="p">;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="锁">锁</h3>
<p>锁机制用于管理对共享资源的并发访问，用来实现事务的隔离级别。</p>
<h4 id="粒度"><strong>粒度</strong></h4>
<p>共享锁和排他锁都是行级锁。MySQL当中事务采用的是粒度锁。针对表（B+树）、页（B+树叶子节点）、行（B+树叶子节点当中某一段记录行）三种粒度加锁。</p>
<p>意向共享锁和意向排他锁都是表级别的锁。</p>
<h4 id="共享锁s"><strong>共享锁（S）</strong></h4>
<p>事务读操作加的锁，对某一行加锁。</p>
<p>在 SERIALIZABLE 隔离级别下，默认帮读操作加共享锁。</p>
<p>在 REPEATABLE READ 隔离级别下，需手动加共享锁，可解决幻读问题。</p>
<p>在 READ COMMITTED 隔离级别下，没必要加共享锁，采用的是 MVCC。</p>
<p>在 READ UNCOMMITTED 隔离级别下，既没有加锁也没有使用 MVCC。</p>
<h4 id="排他锁x"><strong>排他锁（X）</strong></h4>
<p>事务删除或更新加的锁；对某一行加锁。</p>
<p>在4种隔离级别下，都添加了排他锁，事务提交或事务回滚后释放锁。</p>
<h4 id="意向共享锁is"><strong>意向共享锁（IS）</strong></h4>
<p>对一张表中某几行加的共享锁。</p>
<h4 id="意向排他锁ix"><strong>意向排他锁（IX）</strong></h4>
<p>对一张表中某几行加的排他锁。</p>
<h4 id="兼容性"><strong>兼容性</strong></h4>
<p>由于innodb支持的是行级别的锁，意向锁并不会阻塞除了全表扫描以外的任何请求。</p>
<p>意向锁之间是互相兼容的。</p>
<p>IX 对共享锁和排他锁都不兼容。</p>
<p>IS 只对排他锁不兼容。</p>
<p>当想为某一行添加 S 锁，先自动为所在的页和表添加意向锁 IS，再为该行添加 S 锁。</p>
<p>当想为某一行添加 X 锁，先自动为所在的页和表添加意向锁 IX，再为该行添加 X 锁。</p>
<h4 id="锁算法"><strong>锁算法</strong></h4>
<ol>
<li><strong>Record Lock</strong>: 记录锁，单个行记录上的锁。</li>
<li><strong>Gap Lock</strong>： 间隙锁，锁定一个范围，但不包含记录本身。全开区间。REPEATABLE READ级别及以上支持间隙锁。</li>
<li><strong>Next-Key Lock</strong>： 记录锁+间隙锁，锁定一个范围，并且锁住记录本身。左开右闭区间。</li>
<li><strong>Insert Intention Lock</strong>： 插入意向锁，insert操作的时候产生。在多事务同时写入<strong>不同数据</strong>至<strong>同一索引间隙</strong>的时候，并不需要等待其他事务完成，不会发生锁等待。</li>
<li><strong>AUTO-INC Lock</strong>： 自增锁，是一种特殊的表级锁，发生在 AUTO_INCREMENT 约束下的插入操作。采用的一种特殊的表锁机制。完成对自增长值插入的SQL语句后立即释放。在大数据量的插入会影响插入性能，因为另一个事务中的插入会被阻塞。从MySQL 5.1.22开始提供一种轻量级互斥量的自增长实现机制，该机制提高了自增长值插入的性能。</li>
</ol>
<h3 id="mvcc">MVCC</h3>
<p>多版本并发控制，用来实现一致性的非锁定读。非锁定读是指不需要等待访问的行上X锁的释放。</p>
<p>在 read committed 和 repeatable read下，innodb使用MVCC。</p>
<p>对于快照数据的定义不同；</p>
<ol>
<li>在 read committed 隔离级别下，对于快照数据总是读取被锁定行的最新一份快照数据。</li>
<li>repeatable read 隔离级别下，对于快照数据总是读取事务开始时的行数据版本。</li>
</ol>
<h4 id="redolog"><strong>redolog</strong></h4>
<p>redo log用来实现事务的<strong>持久性</strong>。内存中包含 redo log buffer，磁盘中包含 redo log file。</p>
<p>当事务提交时，必须先将该事务的所有日志写入到redolog进行持久化，待事务的commit操作完成才完成了事务的提交。</p>
<p>redo log 顺序写，记录的是对每个页的修改（页、页偏移量、以及修改的内容）。在数据库运行时不需要对 redo log 的文件进行读取操作，只有发生宕机的时候，才会拿redo log进行恢复。</p>
<h4 id="undolog"><strong>undolog</strong></h4>
<p>undo log用来帮助事务回滚以及MVCC的功能。</p>
<p>存储在共享表空间中， undo 是逻辑日志，回滚时将数据库逻辑地恢复到原来的样子，根据 undo log 的记录，做之前的逆运算。</p>
<p>比如事务中有insert 操作，那么执行 delete 操作， 对于 update 操作执行相反的 update 操作。</p>
<p>同时 undo 日志记录行的<strong>版本信息</strong>，用于处理 MVCC 功能。</p>
<h2 id="主从复制">主从复制</h2>
<ol>
<li>主库更新事件(update、insert、delete)通过io-thread写到binlog。</li>
<li>从库请求读取binlog，通过io-thread写⼊（write）从库本地 relay log（中继⽇志）。</li>
<li>从库通过sql-thread读取（read） relay log，并把更新事件在从库中执⾏（replay）⼀遍。</li>
</ol>
<h3 id="读写分离">读写分离</h3>
<p>写主（mysql）读从（内存式数据库）</p>
<h4 id="缓冲层">缓冲层</h4>
<p>使用redis或memcached作为缓冲层，保存一些mysql的热点数据，用于应对高频的读操作。</p>
<p>缓冲策略主要是优化的lru。</p>
<p>但用户无法控制具体缓存哪些东西（与业务无关）</p>
<h3 id="一致性问题">一致性问题</h3>
<p>主从之间存在数据一致性问题</p>
<p>简单的读写策略可以解决大部分问题：（感觉可以参考CPU cache的策略）</p>
<ol>
<li>
<p><strong>写</strong>：写mysql，mysql写完成后同步给redis（有点问题的，因为redis里的还是旧的）</p>
</li>
<li>
<p><strong>读</strong>：读redis，不可用的话再去mysql中找，mysql有就返回并把数据回写redis</p>
</li>
</ol>
<h4 id="强致性"><strong>强⼀致性</strong></h4>
<p>上面写策略还存在点漏洞，这里补齐：</p>
<ol>
<li><strong>写</strong>：先删除redis里的缓存，再去写到mysql中，这样就避免了读到旧数据。</li>
</ol>
<p>但只适用于单数据中心，如果是多数据中心，可以设置强一致性需求忽略缓存层，或转化为单数据中心后操作。</p>
<h4 id="最终致性"><strong>最终⼀致性</strong></h4>
<p>只确保最终的一致性，那就使用一开始的方案就行</p>
<p>但还有一个替代方案：</p>
<p>先写redis，设置key的过期时间为200ms（经验值），等待mysql回写redis，覆盖key，设置更⻓的过期时间。</p>
<p>200ms 默认的是 写mysql到mysql同步到redis的时⻓；这个需要根据实际环境进⾏设置。</p>
<h3 id="缓存穿透">缓存穿透</h3>
<p>假设某个数据redis不存在，mysql也不存在，⽽且⼀直尝试读就会发生缓存穿透，数据最终压⼒依然堆积在mysql，可能造成mysql不堪重负⽽崩溃。</p>
<p><strong>方案</strong></p>
<ol>
<li>发现mysql不存在，将redis设置为 &lt;key, nil&gt; 设置过期时间 下次访问key的时候 不再访问mysql 容易造成redis缓存很多⽆效数据。</li>
<li>布隆过滤器，将mysql当中已经存在的key，写⼊布隆过滤器，不存在的直接pass掉；</li>
</ol>
<h3 id="缓存击穿">缓存击穿</h3>
<p>某些数据redis没有，但是mysql有。此时当⼤量这类数据的并发请求，同样造成mysql压力过⼤。</p>
<p><strong>方案</strong></p>
<ol>
<li>加锁：请求数据的时候获取锁，如果获取成功，则操作完后释放锁。获取失败，则休眠⼀段时间（200ms）再去获取。</li>
<li>增加redis中的存活时间：将很热的key，设置不过期（redis中）</li>
</ol>
<h3 id="缓存雪崩">缓存雪崩</h3>
<p>表示⼀段时间内，缓存集中失效(redis⽆ mysql有)，导致请求全部⾛mysql，有可能搞垮数据库，使整个服务失效。</p>
<p><strong>方案</strong></p>
<ol>
<li>如果因为缓存数据库宕机，造成所有数据涌向mysql：那就采⽤⾼可⽤的集群⽅案，如哨兵模式、cluster模式；</li>
<li>如果因为设置了相同的过期时间，造成缓存集中失效：那就设置随机过期值或者其他机制错开失效。</li>
<li>如果因为系统重启的时候，造成缓存数据消失：重启时间短，redis开启持久化（过期信息也会持久化）就⾏了。 重启时间⻓，提前将热数据导⼊redis当中。</li>
</ol>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/p/redis/">
        
        
            <div class="article-image">
                <img src="/p/redis/353.22a8d1f92c2c1fc3624e87f59876419c_hue47bacef190d5647cba0a16e01e338ad_4596808_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="Redis" 
                        data-hash="md5-IqjR&#43;SwsH8NiTof1mHZBnA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Redis</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/mysql%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">
        
        
            <div class="article-image">
                <img src="/p/mysql%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/_hud7e36f7e20e71be184458283bdae4646_55974_23a5d351d2fc2374f952239b6e9c423a.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="Mysql基本知识" 
                        data-hash="md5-xRTZFpFxc6SKQuARS0aZYQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Mysql基本知识</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Gao&#39;s Happy Day
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#视图">视图</a>
      <ol>
        <li><a href="#优点">优点</a></li>
      </ol>
    </li>
    <li><a href="#触发器">触发器</a></li>
    <li><a href="#存储过程">存储过程</a>
      <ol>
        <li><a href="#优点-1"><strong>优点</strong></a></li>
      </ol>
    </li>
    <li><a href="#游标">游标</a></li>
    <li><a href="#索引">索引</a>
      <ol>
        <li><a href="#主键索引">主键索引</a></li>
        <li><a href="#唯一索引">唯一索引</a></li>
        <li><a href="#普通索引">普通索引</a></li>
        <li><a href="#组合索引">组合索引</a></li>
        <li><a href="#全文索引">全文索引</a></li>
        <li><a href="#主键选择规则">主键选择规则</a></li>
        <li><a href="#索引实现">索引实现</a>
          <ol>
            <li><a href="#索引存储"><strong>索引存储</strong></a></li>
            <li><a href="#聚集索引与辅助索引"><strong>聚集索引与辅助索引</strong></a></li>
            <li><a href="#页和b树"><strong>页和B+树</strong></a></li>
          </ol>
        </li>
        <li><a href="#索引失效">索引失效</a></li>
        <li><a href="#索引原则">索引原则</a></li>
        <li><a href="#约束">约束</a>
          <ol>
            <li><a href="#外键约束"><strong>外键约束</strong></a></li>
            <li><a href="#约束于索引的区别"><strong>约束于索引的区别</strong></a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#事务">事务</a>
      <ol>
        <li><a href="#acid特性">ACID特性</a>
          <ol>
            <li><a href="#原子性a"><strong>原子性（A）</strong></a></li>
            <li><a href="#隔离性i"><strong>隔离性（I）</strong></a></li>
            <li><a href="#持久性d"><strong>持久性（D）</strong></a></li>
            <li><a href="#一致性c"><strong>一致性（C）</strong></a></li>
          </ol>
        </li>
        <li><a href="#事务并发异常">事务并发异常</a>
          <ol>
            <li><a href="#脏读"><strong>脏读</strong></a></li>
            <li><a href="#不可重复读"><strong>不可重复读</strong></a></li>
            <li><a href="#幻读"><strong>幻读</strong></a></li>
          </ol>
        </li>
        <li><a href="#隔离级别">隔离级别</a>
          <ol>
            <li><a href="#read-uncommitted"><strong>READ UNCOMMITTED</strong></a></li>
            <li><a href="#read-committed"><strong>READ COMMITTED</strong></a></li>
            <li><a href="#repeatable-read"><strong>REPEATABLE READ</strong></a></li>
            <li><a href="#serializable"><strong>SERIALIZABLE</strong></a></li>
          </ol>
        </li>
        <li><a href="#锁">锁</a>
          <ol>
            <li><a href="#粒度"><strong>粒度</strong></a></li>
            <li><a href="#共享锁s"><strong>共享锁（S）</strong></a></li>
            <li><a href="#排他锁x"><strong>排他锁（X）</strong></a></li>
            <li><a href="#意向共享锁is"><strong>意向共享锁（IS）</strong></a></li>
            <li><a href="#意向排他锁ix"><strong>意向排他锁（IX）</strong></a></li>
            <li><a href="#兼容性"><strong>兼容性</strong></a></li>
            <li><a href="#锁算法"><strong>锁算法</strong></a></li>
          </ol>
        </li>
        <li><a href="#mvcc">MVCC</a>
          <ol>
            <li><a href="#redolog"><strong>redolog</strong></a></li>
            <li><a href="#undolog"><strong>undolog</strong></a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#主从复制">主从复制</a>
      <ol>
        <li><a href="#读写分离">读写分离</a>
          <ol>
            <li><a href="#缓冲层">缓冲层</a></li>
          </ol>
        </li>
        <li><a href="#一致性问题">一致性问题</a>
          <ol>
            <li><a href="#强致性"><strong>强⼀致性</strong></a></li>
            <li><a href="#最终致性"><strong>最终⼀致性</strong></a></li>
          </ol>
        </li>
        <li><a href="#缓存穿透">缓存穿透</a></li>
        <li><a href="#缓存击穿">缓存击穿</a></li>
        <li><a href="#缓存雪崩">缓存雪崩</a></li>
      </ol>
    </li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
